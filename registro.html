<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Especialistas | Legal Atlas</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --stone-light: #f4f4f0;
            --stone-dark: #1a1a1a;
            --accent-gold: #b8973d;
            --border-stone: #e5e5e0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--stone-light);
            color: var(--stone-dark);
        }

        .font-classic { font-family: 'Cinzel', serif; }

        .input-field {
            background: white;
            border: 1px solid var(--border-stone);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 2px rgba(184, 151, 61, 0.1);
        }

        #map-picker {
            height: 250px;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--border-stone);
            margin-bottom: 1rem;
        }

        .btn-primary {
            background-color: var(--stone-dark);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: var(--accent-gold);
            transform: translateY(-2px);
        }
    </style>
</head>

<body class="min-h-screen p-10">

    <!-- HEADER -->
    <header class="max-w-5xl mx-auto mb-16 flex justify-between items-end">
        <div>
            <h1 class="font-classic text-3xl tracking-[0.3em] mb-2">LEGAL<span class="text-stone-500">ATLAS</span></h1>
            <p class="text-[10px] uppercase tracking-[0.4em] text-[#b8973d] font-bold">Registro de Especialistas</p>
        </div>

        <a href="index.html" class="text-stone-400 hover:text-stone-900 text-[10px] font-bold uppercase tracking-widest transition-all">
            <i class="fas fa-arrow-left mr-2"></i> Volver
        </a>
    </header>

    <!-- BLOQUE CENTRAL — FRASE -->
    <section class="max-w-3xl mx-auto text-center mb-20">
        <h2 class="font-classic text-4xl mb-6 leading-tight">
            Únete a la infraestructura jurídica del futuro.
        </h2>

        <p class="text-stone-600 font-light text-sm leading-relaxed">
            Buscamos firmas con rigor ético para conectar con usuarios del motor APOLO.
            Complete su perfil profesional para iniciar el proceso de verificación.
        </p>
    </section>

    <!-- BLOQUE INFERIOR: BENEFICIOS + FORMULARIO -->
    <main class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-16">

        <!-- COLUMNA IZQUIERDA — BENEFICIOS -->
        <section class="space-y-10">

            <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center border border-stone-200 shadow-sm">
                    <i class="fas fa-check text-[12px] text-[#b8973d]"></i>
                </div>
                <div>
                    <p class="text-[11px] font-bold uppercase tracking-wider">Perfil Verificado</p>
                    <p class="text-xs text-stone-500 font-light">Validamos tu trayectoria y cédula profesional.</p>
                </div>
            </div>

            <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center border border-stone-200 shadow-sm">
                    <i class="fas fa-map-marker-alt text-[12px] text-[#b8973d]"></i>
                </div>
                <div>
                    <p class="text-[11px] font-bold uppercase tracking-wider">Presencia en Mapa</p>
                    <p class="text-xs text-stone-500 font-light">Aparece en búsquedas geolocalizadas de clientes.</p>
                </div>
            </div>

            <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center border border-stone-200 shadow-sm">
                    <i class="fas fa-shield-alt text-[12px] text-[#b8973d]"></i>
                </div>
                <div>
                    <p class="text-[11px] font-bold uppercase tracking-wider">Rigor Ético</p>
                    <p class="text-xs text-stone-500 font-light">Solo admitimos especialistas con estándares profesionales elevados.</p>
                </div>
            </div>

        </section>

        <!-- COLUMNA DERECHA — FORMULARIO -->
        <section>

<form id="registroForm" class="space-y-6">
    <div>
        <label class="text-[9px] uppercase font-bold text-stone-400 tracking-widest mb-2 block">Información General</label>
        <input type="text" id="nombre" placeholder="Nombre completo o Firma" class="w-full p-4 rounded-xl input-field text-sm outline-none" required>
    </div>

    <div class="grid grid-cols-2 gap-4">
        <select id="tipo_perfil" class="p-4 rounded-xl input-field text-sm outline-none cursor-pointer">
            <option value="Particular">Abogado Particular</option>
            <option value="Despacho">Despacho / Firma</option>
        </select>

        <select id="materia" class="p-4 rounded-xl input-field text-sm outline-none cursor-pointer">
            <option value="Civil">Materia Civil</option>
            <option value="Penal">Materia Penal</option>
            <option value="Laboral">Materia Laboral</option>
            <option value="Familiar">Materia Familiar</option>
        </select>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="email" id="email" placeholder="Email Profesional" class="p-4 rounded-xl input-field text-sm outline-none" required>
        <input type="url" id="web_url" placeholder="Sitio Web (https://...)" class="p-4 rounded-xl input-field text-sm outline-none">
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="text" id="foto_url" placeholder="URL de Foto o Logo (link)" class="p-4 rounded-xl input-field text-sm outline-none">
        <input type="tel" id="whatsapp" placeholder="WhatsApp (52...)" class="p-4 rounded-xl input-field text-sm outline-none" required>
    </div>

    <div>
        <label class="text-[9px] uppercase font-bold text-stone-400 tracking-widest mb-2 block text-center">Ubicación del Despacho (Haz clic)</label>
        <div id="map-picker"></div>
        <input type="hidden" id="coords" required>
        <p id="coord-status" class="text-[10px] text-center text-stone-400 italic mt-1">Selecciona tu oficina en el mapa</p>
    </div>

    <button type="submit" class="w-full py-5 btn-primary text-white rounded-2xl font-bold uppercase tracking-[0.2em] text-[10px] shadow-lg">
        Enviar Perfil para Verificación
    </button>
</form>

        </section>

    </main>

    <script>
    // Configuración con tus credenciales actuales
    const supabaseUrl = 'https://nuzzmcxirsghykzqbmmn.supabase.co';
    const supabaseKey = 'sb_publishable_yz1em9S40ZqDlB5Ou80Z5g_TCN4hCff';
    
    // IMPORTANTE: Asegúrate de que la librería cargue como 'supabase'
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const map = L.map('map-picker').setView([21.12, -101.68], 13);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    let marker;

    map.on('click', function (e) {
        const lat = e.latlng.lat.toFixed(6);
        const lng = e.latlng.lng.toFixed(6);

        if (marker) { marker.setLatLng(e.latlng); } 
        else { marker = L.marker(e.latlng).addTo(map); }

        document.getElementById('coords').value = `${lat}, ${lng}`;
        document.getElementById('coord-status').innerText = `Ubicación marcada: ${lat}, ${lng}`;
        document.getElementById('coord-status').style.color = "#b8973d";
    });

    document.getElementById('registroForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const coordValue = document.getElementById('coords').value;
        if (!coordValue) {
            alert("Por favor, selecciona tu ubicación en el mapa.");
            return;
        }

        const btn = e.target.querySelector('button');
        btn.innerText = "PROCESANDO...";
        btn.disabled = true;

        // DATOS A ENVIAR (Asegúrate que estas columnas EXISTAN en Supabase)
        const nuevoAbogado = {
             nombre: document.getElementById('nombre').value,
             materia: document.getElementById('materia').value,
             coords: coordValue,
             whatsapp: document.getElementById('whatsapp').value,
             email: document.getElementById('email').value,
             web_url: document.getElementById('web_url').value,
             foto_url: document.getElementById('foto_url').value,
             ciudad: ciudadDetectada,
             estado: "guanajuato",
             flag_activo: false
          };

        const { error } = await _supabase.from('abogados').insert([nuevoAbogado]);

        if (error) {
            alert("Error: " + error.message);
            console.error(error);
            btn.innerText = "ENVIAR PERFIL";
            btn.disabled = false;
        } else {
            alert("Registro exitoso. Tu perfil pasará a revisión.");
            window.location.href = "directorio.html";
        }
    });
</script>

</body>
</html>